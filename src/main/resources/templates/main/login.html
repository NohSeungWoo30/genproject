<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>로그인</title>
    <link rel="stylesheet" href="/css/vars.css" />
    <link rel="stylesheet" href="/css/login-style.css" />
    <style>
        .welcome-box {
          background: var(--color-grey-95, #f9f9f9);
          border: 1px solid var(--color-grey-90, #ddd);
          border-radius: 8px;
          padding: 24px;
          margin-top: 20px;
          text-align: center;
          font-size: 16px;
        }

        .btn-logout {
          margin-top: 20px;
          padding: 10px 20px;
          font-size: 15px;
          background-color: var(--color-cornflower-blue, #4a90e2);
          color: white;
          border: none;
          border-radius: 6px;
          cursor: pointer;
        }
    </style>
</head>
<body>
<div class="container">
    <h2>로그인</h2>
    <form id="loginForm">
        <div class="form-group">
            <label for="email">아이디</label>
            <input
                    type="email"
                    id="email"
                    name="email"
                    placeholder="아이디를 입력해주세요"
                    required
            />
        </div>
        <div class="form-group password-wrapper">
            <label for="password">비밀번호</label>
            <input
                    type="password"
                    id="password"
                    name="password"
                    placeholder="비밀번호를 입력해주세요"
                    required
            />
            <button type="button" id="togglePassword" class="btn-toggle">보기</button>
        </div>
        <button type="submit" class="btn-submit">로그인</button>
        <p class="text-helper">
            <a href="signup.html" id="signupLink">회원가입</a> ·
            <a href="Id_Passwordfind.html" id="findAccountLink">아이디·비밀번호 찾기</a>
        </p>
        <div class="divider">또는</div>
        <button type="button" id="googleLogin" class="btn-social google">
            <img
                    src="/img/img(로그인회원가입)/icon-google0.svg"
                    alt="Google 아이콘"
                    class="social-icon"
            />
            <span>Google로 시작하기</span>
        </button>
        <button type="button" id="kakaoLogin" class="btn-social kakao">
            <img
                    src="/img/img(로그인회원가입)/icon-kakao0.svg"
                    alt="Kakao 아이콘"
                    class="social-icon"
            />
            <span>카카오로 시작하기</span>
        </button>
    </form>
</div>

<script>
    const passwordInput = document.getElementById('password');
    const togglePasswordBtn = document.getElementById('togglePassword');
    togglePasswordBtn.addEventListener('click', function () {
      if (passwordInput.type === 'password') {
        passwordInput.type = 'text';
        togglePasswordBtn.textContent = '숨기기';
      } else {
        passwordInput.type = 'password';
        togglePasswordBtn.textContent = '보기';
      }
    });

    const loginForm = document.getElementById('loginForm');
    loginForm.addEventListener('submit', async function (event) {
      event.preventDefault();

      const emailValue = document.getElementById('email').value.trim();
      const passwordValue = passwordInput.value.trim();

      if (!emailValue) {
        alert('이메일을 입력해주세요.');
        document.getElementById('email').focus();
        return;
      }

      if (!passwordValue) {
        alert('비밀번호를 입력해주세요.');
        passwordInput.focus();
        return;
      }

      try {
        const response = await fetch('/api/login', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            email: emailValue,
            password: passwordValue
          })
        });

        if (!response.ok) {
          const err = await response.json();
          alert('로그인 실패: ' + (err.message || '아이디/비밀번호를 확인해주세요.'));
          return;
        }

        const data = await response.json();
        const { user_idx, token } = data;

        sessionStorage.setItem('user_idx', user_idx);
        sessionStorage.setItem('auth_token', token);

        // 로그인 완료 UI로 변경
        document.querySelector('.container').innerHTML = `
          <h2>환영합니다!</h2>
          <div class="welcome-box">
            <p><strong>${emailValue}</strong> 님, 반갑습니다!</p>
            <button id="logoutBtn" class="btn-logout">로그아웃</button>
          </div>
        `;

        document.getElementById('logoutBtn').addEventListener('click', function () {
          sessionStorage.removeItem('user_idx');
          sessionStorage.removeItem('auth_token');
          location.reload();
        });

      } catch (error) {
        console.error(error);
        alert('서버 요청 중 오류가 발생했습니다.');
      }
    });

    document.getElementById('googleLogin').addEventListener('click', function () {
      window.location.href = '/oauth/google';
    });

    document.getElementById('kakaoLogin').addEventListener('click', function () {
      window.location.href = '/oauth/kakao';
    });
</script>
</body>
</html>
