<!DOCTYPE html>
<html lang="ko"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head>
    <meta charset="UTF-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>상품 목록</title>
    <link rel="stylesheet" th:href="@{/css/mainvars.css}"/>
    <link rel="stylesheet" th:href="@{/css/mainstyle.css}"/>
    <link rel="stylesheet" th:href="@{/css/product-card.css}"/>
    <link rel="stylesheet" th:href="@{/css/payment-modal-style.css}"/>
    <link rel="stylesheet" href="/css/toast.css" />
    <link rel="stylesheet" href="/css/notify.css" />
    <th:block th:replace="fragments/user-session :: sessionScript"></th:block>

    <script src="https://cdn.tailwindcss.com"></script>
    <script type="module" src="https://unpkg.com/ionicons@5.5.2/dist/ionicons/ionicons.esm.js"></script>
    <script nomodule src="https://unpkg.com/ionicons@5.5.2/dist/ionicons/ionicons.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sockjs-client@1/dist/sockjs.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/stompjs@2.3.3/lib/stomp.min.js"></script>
    <script src="https://js.tosspayments.com/v1/payment-widget"></script>

    <style>
        .bottom-nav .bottom-link.active {
          font-weight: bold;
          border-bottom: 2px solid #FFFFFF;
          padding-bottom: 6px;
        }

        ._1920-w-light {
          overflow-x: hidden;
          min-height: 500px;
        }

        .container2 {
          max-width: 1280px;
          width: 100%;
          margin: 0 auto;
          padding: 40px;
          overflow-x: hidden;
          box-sizing: border-box;
        }

        .flex-row {
          display: grid;
          grid-template-columns: repeat(4, 1fr);
          gap: 25px;
          box-sizing: border-box;
          overflow-x: hidden;
        }

        .product-card {
          display: flex;
          flex-direction: column;
          min-height: 450px;
          background: #fff;
          border-radius: 8px;
          box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        }

        .product-thumb {
          min-height: 180px;
          display: flex;
          align-items: center;
          justify-content: center;
          border-top-left-radius: 8px;
          border-top-right-radius: 8px;
          background: #f5f6f8;
        }

        .product-info {
          display: flex;
          flex-direction: column;
          flex-grow: 1;
          padding: 25px;
        }

        .placeholder-title {
          font-size: 2em;
          font-weight: bold;
        }

        .placeholder-subtitle {
          font-size: 1.5em;
          margin-top: 10px;
          color: #666;
        }

        .product-title {
          font-size: 1.2em;
          font-weight: bold;
          margin-bottom: 4px;
        }

        .product-price {
          font-size: 1.5em;
          font-weight: bold;
          margin-bottom: 12px;
          color: #333;
        }

        .product-desc {
          font-size: 1.1em;
          color: #555;
          margin-bottom: 20px;
          flex-grow: 1;
        }

        .product-button {
          font-size: 1.1em;
          padding: 14px 16px;
          border-radius: 6px;
          cursor: pointer;
          border: none;
          transition: background 0.2s;
        }

        .btn-pay {
          background: #0066ff;
          color: #fff;
          margin-bottom: 8px;
        }

        .product-button:hover {
          opacity: 0.9;
        }


    </style>
</head>
<body>
<div class="_1920-w-light">

    <!-- ─── 상단 네비게이션 ─── -->
    <header class="container-nav">
        <div class="nav-left">
            <a th:href="@{/main}"><img class="logo" src="/img/icons/Group 17.png" alt="M 로고"></a>
        </div>

        <div class="nav-center">
            <img src="/img/봄.png" class="nav-img" alt="그림10">
            <img src="/img/여름.png" class="nav-img" alt="그림10">
            <img src="/img/가을.png" class="nav-img" alt="그림10">
            <img src="/img/겨울.png" class="nav-img" alt="그림10">
        </div>

        <!-- ** navRight: 로그인/알림/프로필 영역(동적) ** -->
        <div class="nav-right" id="navRight">
            <a href="/user/login" class="login-link">로그인ㆍ회원가입</a>
        </div>
    </header>

    <!-- ─── 하단 고정 네비 (모바일 bottom‑nav 스타일) ─── -->
    <section class="bottom-nav-wrapper">
        <nav class="bottom-nav">
            <a th:href="@{/group/create}" class="bottom-link">모임 생성</a>
            <a th:href="@{/group/meetinglist}" class="bottom-link">모임 목록</a>
            <a th:href="@{/product-list}" class="bottom-link">상품 목록</a>
            <a th:href="@{/posts}" class="bottom-link">자유 게시판</a>
        </nav>
    </section>

    <section class="container2">
        <div class="flex-row">

            <!-- 1회 이용권 -->
            <div class="product-card free">
                <div class="product-thumb">
                    <div class="product-text-placeholder">
                        <p class="placeholder-title">1회 이용권</p>
                    </div>
                </div>
                <div class="product-info">
                    <div class="product-title">1회 이용권</div>
                    <div class="product-price">2,000원</div>
                    <div class="product-desc">• 모임 방 만들기 또는 참여 (1회)</div>
                    <button sec:authorize="isAuthenticated()"
                            class="product-button btn-pay"
                            data-product-name="1회 이용권"
                            data-amount="2000">
                        결제하기
                    </button>
                    <button sec:authorize="!isAuthenticated()"
                            class="product-button"
                            th:onclick="|location.href='@{/login}'|">
                        로그인 후 결제
                    </button>
                </div>
            </div>

            <!-- 3회 이용권 -->
            <div class="product-card standard">
                <div class="product-thumb">
                    <div class="product-text-placeholder">
                        <p class="placeholder-title">3회 이용권</p>
                    </div>
                </div>
                <div class="product-info">
                    <div class="product-title">3회 이용권</div>
                    <div class="product-price">4,500원</div>
                    <div class="product-desc">• 모임 방 만들기 또는 참여 (3회)</div>
                    <button sec:authorize="isAuthenticated()"
                            class="product-button btn-pay"
                            data-product-name="3회 이용권"
                            data-amount="4500">
                        결제하기
                    </button>
                    <button sec:authorize="!isAuthenticated()"
                            class="product-button"
                            th:onclick="|location.href='@{/login}'|">
                        로그인 후 결제
                    </button>
                </div>
            </div>

            <!-- 5회 이용권 -->
            <div class="product-card premium">
                <div class="product-thumb">
                    <div class="product-text-placeholder">
                        <p class="placeholder-title">5회 이용권</p>
                    </div>
                </div>
                <div class="product-info">
                    <div class="product-title">5회 이용권</div>
                    <div class="product-price">6,500원</div>
                    <div class="product-desc">• 모임 방 만들기·참여 (5회)</div>
                    <button sec:authorize="isAuthenticated()"
                            class="product-button btn-pay"
                            data-product-name="5회 이용권"
                            data-amount="6500">
                        결제하기
                    </button>
                    <button sec:authorize="!isAuthenticated()"
                            class="product-button"
                            th:onclick="|location.href='@{/login}'|">
                        로그인 후 결제
                    </button>
                </div>
            </div>

            <!-- 10회 이용권 -->
            <div class="product-card vip">
                <div class="product-thumb">
                    <div class="product-text-placeholder">
                        <p class="placeholder-title">10회 이용권</p>
                    </div>
                </div>
                <div class="product-info">
                    <div class="product-title">10회 이용권</div>
                    <div class="product-price">11,500원</div>
                    <div class="product-desc">• 모임 방 만들기·참여 (10회)</div>
                    <button sec:authorize="isAuthenticated()"
                            class="product-button btn-pay"
                            data-product-name="10회 이용권"
                            data-amount="11500">
                        결제하기
                    </button>
                    <button sec:authorize="!isAuthenticated()"
                            class="product-button"
                            th:onclick="|location.href='@{/login}'|">
                        로그인 후 결제
                    </button>
                </div>
            </div>

        </div>
    </section>

    <!-- ─── Footer ─── -->
    <footer class="footer">
        <div class="footer-links">
            <a href="about.html" class="footer-link">회사소개</a><span class="footer-divider"></span>
            <a href="partnership.html" class="footer-link">제휴안내</a><span class="footer-divider"></span>
            <a href="advertising.html" class="footer-link">광고안내</a><span class="footer-divider"></span>
            <a href="terms.html" class="footer-link">이용약관</a><span class="footer-divider"></span>
            <a href="privacy.html" class="footer-link">개인정보처리방침</a><span class="footer-divider"></span>
            <a href="youth-policy.html" class="footer-link">청소년보호정책</a>
        </div>
        <div class="footer-copyright">© 1999 – 2025 dcinside. All rights reserved.</div>
    </footer>

    <!-- 결제 모달 -->
    <div id="payment-modal-backdrop" class="payment-modal-backdrop">
        <div id="payment-widget-container" class="payment-widget-container">
            <h2 class="modal-title">결제 정보 입력</h2>
            <button id="modal-close-x-button" class="modal-close-x-button">&times;</button>
            <div id="payment-methods-div"></div>
            <div id="agreement-div" class="agreement-div"></div>
            <div class="modal-button-group">
                <button id="request-payment-button" class="card-button primary-button">결제하기</button>
                <button id="close-widget-button" class="card-button secondary-button">닫기</button>
            </div>
        </div>
    </div>
</div>



<script th:inline="javascript">
    document.addEventListener('DOMContentLoaded', function () {
      if (typeof window.PaymentWidget === 'undefined') return;
      const clientKey = 'test_gck_docs_Ovk5rk1EwkEbP0W43n07xlzm';
      const userIdx = /*[[${userIdx}]]*/ null;
      const customerKey = userIdx ? String(userIdx) : 'guest_' + new Date().getTime();
      const paymentWidget = PaymentWidget(clientKey, customerKey);

      const modalBackdrop = document.getElementById('payment-modal-backdrop');
      const methodsDiv = document.getElementById('payment-methods-div');
      const agreementDiv = document.getElementById('agreement-div');
      const reqBtn = document.getElementById('request-payment-button');
      const closeBtn = document.getElementById('close-widget-button');
      const xBtn = document.getElementById('modal-close-x-button');
      let currentOrder='', currentAmt=0;

      document.querySelectorAll('.btn-pay').forEach(btn => btn.addEventListener('click', () => {
        currentOrder = btn.dataset.productName;
        currentAmt = parseInt(btn.dataset.amount,10);
        if (isNaN(currentAmt)) return alert('금액 오류');
        paymentWidget.renderPaymentMethods('#payment-methods-div',{value:currentAmt});
        paymentWidget.renderAgreement('#agreement-div');
        modalBackdrop.style.display='flex';
      }));

      reqBtn.addEventListener('click', () => {
        const orderId = 'order_'+Date.now();
        const successUrl = new URL(window.location.origin+'/payment/result');
        successUrl.searchParams.append('orderName', currentOrder);
        const failUrl = new URL(window.location.origin+'/payment/fail');
        failUrl.searchParams.append('orderName', currentOrder);
        paymentWidget.requestPayment({
          orderId, orderName: currentOrder,
          customerName: /*[[${#authentication.name}]]*/'비회원',
          customerEmail: '/*[[${#authentication.name != null ? #authentication.name : "test@example.com"}]]*/',

          successUrl: successUrl.toString(),
          failUrl: failUrl.toString()
        }).catch(err=>{if(err.code!=='USER_CANCEL')alert('오류:'+err.message);});
      });

      function closeModal(){
        modalBackdrop.style.display='none';
        methodsDiv.innerHTML=''; agreementDiv.innerHTML='';
      }
      closeBtn.addEventListener('click',closeModal);
      xBtn.addEventListener('click',closeModal);
      modalBackdrop.addEventListener('click',e=>{if(e.target===modalBackdrop)closeModal();});
    });
</script>

<th:block th:replace="fragments/notification-templates :: notiTemplates"></th:block>
<script src="/js/notify.js" defer></script>
<script src="/js/notification.js" defer></script>

</body>
</html>
