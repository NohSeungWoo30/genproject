<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ê·¸ë£¹ ìƒì„¸ ëª¨ë‹¬</title>
  <link rel="stylesheet" href="/css/meetingdetail.css" />



  <!-- 1. í•„ìˆ˜ ë¼ì´ë¸ŒëŸ¬ë¦¬: SockJS, STOMP -->
  <script src="https://cdn.jsdelivr.net/npm/sockjs-client@1/dist/sockjs.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/stompjs@2.3.3/lib/stomp.min.js"></script>


  <script th:inline="javascript">
    window.room = [[${roomJson}]];
    window.userId = [[${currentUser.userIdx}]];
    window.groupId = [[${room.groupIdx}]];
    window.isChatJoined = [[${isJoined}]];
  </script>

</head>
<body>

<!--ë¡œê·¸ì¸ ì„¸ì…˜ê´€ë ¨ ê³„ì† ì¶”ê°€í•˜ê¸°-->
<th:block th:replace="fragments/user-session :: sessionScript"></th:block>

<!-- âœ… ë””ë²„ê·¸ìš© ì‚¬ìš©ì í™•ì¸ ì¶œë ¥ -->
<p th:if="${user == null}" style="color:red;">[ë””ë²„ê·¸] userëŠ” nullì…ë‹ˆë‹¤.</p>
<p th:if="${user != null}" style="color:green;">[ë””ë²„ê·¸] userëŠ” ì¡´ì¬í•©ë‹ˆë‹¤. ID: <span th:text="${user.userIdx}">?</span></p>

<!-- âœ… ê·¸ë£¹ ìƒì„¸ ëª¨ë‹¬ -->
<div id="group-detail-modal" class="fixed hidden inset-0 z-50 bg-black bg-opacity-40 flex items-center justify-center">
  <div class="bg-white rounded-xl shadow-lg w-full max-w-3xl relative overflow-y-auto max-h-[90vh]">
    <button onclick="closeGroupDetailModal()" class="absolute top-2 right-2 text-2xl text-gray-500 hover:text-black">âœ•</button>

    <section class="room-detail-section">
      <div id="roomDetailCard"></div>
      <div id="inline-chat-wrapper" style="display:none;"></div>
    </section>

    <!-- ì‹ ê³  ëª¨ë‹¬ -->
    <div id="report-modal" style="display:none; position:fixed; top:20%; left:40%; background:white; padding:20px; border:1px solid #ccc; z-index:9999;">
      <h3>ğŸš¨ ë©”ì‹œì§€ ì‹ ê³ </h3>
      <label>ì‹ ê³  ì‚¬ìœ 
        <select id="report-reason">
          <option value="1">ìš•ì„¤/ë¹„ë°©/í˜ì˜¤ í‘œí˜„</option>
          <option value="2">ìŒë€/ì„ ì •ì ì¸ ì½˜í…ì¸ </option>
          <option value="3">ë„ë°°/ìŠ¤íŒ¸/ê´‘ê³ </option>
          <option value="4">ê°œì¸ ì •ë³´ ë…¸ì¶œ</option>
          <option value="5">ì‚¬ì¹­/í—ˆìœ„ ì •ë³´</option>
          <option value="6">ë¶€ì ì ˆí•œ ë‚´ìš©</option>
          <option value="7">ëª¨ì„ ìš´ì˜ ë°©í•´</option>
          <option value="8">ê¸°íƒ€</option>
        </select>
      </label><br><br>
      <textarea id="report-comment" placeholder="ì‹ ê³  ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”" rows="4" cols="40"></textarea><br><br>
      <button onclick="submitReport()">ğŸš¨ ì‹ ê³  ì œì¶œ</button>
      <button onclick="closeReportModal()">âŒ ë‹«ê¸°</button>
    </div>

    <!-- ì‚­ì œëœ ë©”ì‹œì§€ í…œí”Œë¦¿ -->
    <template id="deleted-message-template">
      <div class="message-group deleted">
        <div class="message self">
          <div class="content-container">
            <div class="bubble-container">
              <div class="bubble">ì‚­ì œëœ ë©”ì‹œì§€ì…ë‹ˆë‹¤.</div>
              <span class="timestamp"></span>
            </div>
          </div>
        </div>
      </div>
    </template>
  </div>
</div>

<!-- âœ… ì—°ê²°ëœ ìŠ¤í¬ë¦½íŠ¸ (meetingdetail.jsì˜ ìˆ˜ì •ë³¸ì´ ë¡œë“œë˜ì–´ì•¼ í•¨) -->
<script src="/js/meetingdetail.js" defer></script>
<script>
  function openGroupDetailModal(roomData) {
    window.room = roomData;
    window.isChatJoined = roomData.participants?.some(p => p.name === window.currentLoggedInUser?.name);
    document.getElementById('group-detail-modal').classList.remove('hidden');
    displayRoomDetails();
    if (window.isChatJoined) showInlineChat(false);
  }
  function closeGroupDetailModal() {
    document.getElementById('group-detail-modal').classList.add('hidden');
  }
</script>

</body>



</html>