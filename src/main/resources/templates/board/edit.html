<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8" />
    <title>게시글 수정</title>
    <link rel="stylesheet" href="/css/vars.css" />
    <link rel="stylesheet" href="/css/boardstyle.css" />
    <link rel="stylesheet" href="/css/edit.css" />
    <link rel="stylesheet" href="/css/mainstyle.css" />

    <!--토스트(우측하단 실시간 알림) 추가 모든 페이지에 꼭 추가하기-->
    <link rel="stylesheet" href="/css/toast.css" />
    <!--알림(종모양)기능 css추가 알림기능이 포함되는 모든 곳에 추가하기-->
    <link rel="stylesheet" href="/css/notify.css" />
    <!--로그인 세션관련 계속 추가하기-->
    <th:block th:replace="fragments/user-session :: sessionScript"></th:block>

    <!--알림 아이콘관련 계속 추가하기-->
    <script src="https://cdn.tailwindcss.com"></script>
    <script type="module" src="https://unpkg.com/ionicons@5.5.2/dist/ionicons/ionicons.esm.js"></script>
    <script nomodule src="https://unpkg.com/ionicons@5.5.2/dist/ionicons/ionicons.js"></script>

    <!-- 1. 필수 라이브러리: SockJS, STOMP -->
    <script src="https://cdn.jsdelivr.net/npm/sockjs-client@1/dist/sockjs.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/stompjs@2.3.3/lib/stomp.min.js"></script>


</head>
<body>

<!-- 상단 네비게이션 바 -->
<header class="container-nav">
    <div class="nav-left">
        <a th:href="@{/main}"><img class="logo" src="/img/icons/Group 17.png" alt="M 로고"></a>
    </div>

    <div class="nav-right" id="navRight">
        <a href="/user/login" class="login-link">로그인ㆍ회원가입</a>
    </div>
</header>

<!--하단 네비게이션 바-->
<section class="bottom-nav-wrapper">
    <nav class="bottom-nav">
        <a href="#" class="bottom-link">모임 생성</a>
        <a href="meeting-list.html" class="bottom-link">모임 목록</a>
        <a href="#" class="bottom-link">상품 목록</a>
        <a th:href="@{/posts}" class="bottom-link">자유 게시판</a>
    </nav>
</section>

<div class="detail-container">
    <form th:action="@{/posts/{id}/edit(id=${post.postIdx})}"
          method="post" enctype="multipart/form-data">

        <h2>게시글 수정</h2>

        <label for="category">카테고리</label>
        <select id="category" name="category" required>
            <option value="공지" th:selected="${post.category == '공지'}">공지</option>
            <option value="자유" th:selected="${post.category == '자유'}">자유</option>
            <option value="질문" th:selected="${post.category == '질문'}">질문</option>
            <option value="정보" th:selected="${post.category == '정보'}">정보</option>
        </select>

        <label for="title">제목</label>
        <input type="text" id="title" name="title" th:value="${post.title}" placeholder="제목 입력" required />

        <label for="content">내용</label>
        <textarea id="content" name="content" th:text="${post.content}" placeholder="내용 입력"></textarea>


        <label for="files">첨부파일</label>
        <input type="file" id="files" name="files" multiple />
        <div class="image-preview-list" id="imagePreviewList"></div>


        <button type="submit" class="submit-button">수정 완료</button>
    </form>
</div>

<script>
    const fileInput = document.getElementById('files');
    const previewContainer = document.getElementById('imagePreviewList');

    fileInput.addEventListener('change', function () {
      previewContainer.innerHTML = '';
      const files = Array.from(fileInput.files);
      files.forEach(file => {
        const reader = new FileReader();
        reader.onload = e => {
          const img = document.createElement('img');
          img.src = e.target.result;
          previewContainer.appendChild(img);
        };
        reader.readAsDataURL(file);
      });
    });
</script>

<!--꼭 notify.js나 notification.js 보다 위에-->
<th:block th:replace="fragments/notification-templates :: notiTemplates"></th:block>

<script src="/js/notify.js" defer></script>
<script src="/js/notification.js" defer></script>
</body>
</html>
